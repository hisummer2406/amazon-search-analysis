# 内存配置 (8GB系统) - 针对大文件处理优化
shared_buffers = 1GB                    # 降低到1GB，为应用程序留更多内存
effective_cache_size = 4GB              # 降低到4GB
work_mem = 128MB                        # 降低单操作内存，避免OOM
maintenance_work_mem = 512MB            # 降低维护内存

# 并发配置 - 针对4核优化
max_connections = 30                    # 减少最大连接数
max_worker_processes = 4                # 等于CPU核心数
max_parallel_workers_per_gather = 1    # 减少并行查询
max_parallel_workers = 2               # 减少总并行工作进程

# I/O 配置
effective_io_concurrency = 100         # 降低IO并发
random_page_cost = 1.1                 # SSD优化
checkpoint_completion_target = 0.9
wal_buffers = 16MB
checkpoint_timeout = 15min              # 增加检查点间隔

# 大文件处理优化
wal_level = minimal                     # 最小WAL日志
max_wal_senders = 0                     # 禁用复制
archive_mode = off                      # 禁用归档
synchronous_commit = off                # 异步提交，提高性能
fsync = on                             # 保持数据安全
full_page_writes = on                   # 保持数据完整性

# 超时配置 - 关键优化
statement_timeout = 300000              # 5分钟语句超时（300秒）
idle_in_transaction_session_timeout = 600000  # 10分钟事务超时（600秒）
lock_timeout = 180000                   # 3分钟锁超时
tcp_keepalives_idle = 600              # TCP保活
tcp_keepalives_interval = 30
tcp_keepalives_count = 3

# 连接配置
listen_addresses = '*'                  # 允许所有IP连接
timezone = 'Asia/Shanghai'

# 内存参数优化
temp_buffers = 32MB                     # 临时表缓冲区
max_prepared_transactions = 0           # 禁用预准备事务